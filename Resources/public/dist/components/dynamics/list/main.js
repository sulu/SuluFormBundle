define(["jquery"],function(a){"use strict";var b={toolbarId:"dynamic-toolbar",toolbarKey:"dynamics",listId:"dynamic-list",endPointUrl:"/admin/api/form/dynamics",fieldsAction:"/admin/api/form/dynamics/fields",translatePrefix:"sulu_form.forms."};return{layout:function(){return{extendExisting:!0,content:{width:this.options.width?this.options.width:"fixed",leftSpace:!0,rightSpace:!0}}},initialize:function(){this.render(),this.bindCustomEvents(),this.initPreview()},initPreview:function(){this.sandbox.emit("sulu.preview.initialize",null,!0)},bindCustomEvents:function(){this.sandbox.on("sulu.toolbar.delete",this.deleteSelected.bind(this))},deleteSelected:function(){this.sandbox.emit("husky.datagrid.items.get-selected",function(c){var d=0;a.each(c,function(e,f){this.sandbox.emit("husky.datagrid.record.remove",f),a.ajax({url:b.endPointUrl+"/"+f,type:"DELETE",success:function(a){++d,d===c.length&&this.sandbox.emit("sulu.labels.success.show",b.translatePrefix+"delete.success","labels.success")}.bind(this)})}.bind(this))}.bind(this))},getUrlParameters:function(){var a={form:this.getFormDataProperty(this.options.property),webspaceKey:this.options.webspace,locale:this.options.language,view:this.options.view,sortBy:"created",sortOrder:"desc"};return this.options.type&&(a.type=this.options.type,a.typeId=this.getFormDataProperty("id")),a},getFormDataProperty:function(a){var b=this.getFormData();if(b||"undefined"!=typeof b[a])return b[a]},getFormData:function(){var a=null;if("function"==typeof this.options.data?a=this.options.data():"object"==typeof this.options.data?a=this.options.data:"undefined"!=typeof this.options&&(a=this.options),a){if(this.options.page>1){if("undefined"===a._embedded||"undefined"==typeof a._embedded.pages)return;a=a._embedded.pages[this.options.page-2]}return a}},render:function(){this.sandbox.dom.html(this.$el,'<div id="'+b.toolbarId+'"></div><div id="'+b.listId+'"></div>');var c=this.getUrlParameters();if(!c.form)return void a("#"+b.listId).html("<h3>"+app.sandbox.translate("select.no-choice")+"</h3>");var d="?"+a.param(c);this.sandbox.sulu.initListToolbarAndList.call(this,b.toolbarKey,b.fieldsAction+d,{el:this.$find("#"+b.toolbarId),template:this.sandbox.sulu.buttons.get({deleteSelected:{},settings:{options:{id:"settings",dropdownItems:{"export":{options:{title:"public.export",icon:"download",callback:function(){var d=a("<div/>");a("body").append(d);var e={el:d,urlParameter:c,url:b.endPointUrl+".csv"};App.start([{name:"csv-export@suluform",options:e}]).fail(function(){console.warn("Ignore error! For date-range specific export at least Sulu 1.5 is needed. Automatic fallback to default export."),App.start([{name:"csv-export@suluadmin",options:e}])})}.bind(this)}},columnOptions:{options:{type:"columnOptions"}}}}}}),instanceName:this.instanceName},{el:this.$find("#"+b.listId),instanceName:this.instanceName,url:b.endPointUrl+d,resultKey:"dynamics",searchFields:["id","email","firstName","lastName"],viewOptions:{table:{fullWidth:!0}}})}}});